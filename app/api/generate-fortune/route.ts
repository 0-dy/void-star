import { NextResponse } from 'next/server';

// 10초 타임아웃 방지
export const maxDuration = 10;
export const dynamic = 'force-dynamic';

const FORTUNE_TEMPLATES = [
    { title: "새로운 기운이 샘솟는 하루입니다! 🌱", text: "{name}님, 오늘 하루는 그동안 머뭇거렸던 일에 과감히 도전해보기 좋은 날입니다. 작은 성공이 큰 파도를 만들어낼 거예요." },
    { title: "뜻밖의 행운이 찾아올지도 몰라요! 🍀", text: "{name}님, 오늘은 주변 사람들의 말에 귀 기울여보세요. 평범한 대화 속에서 귀중한 힌트를 얻을 수 있는 날입니다." },
    { title: "꾸준함이 빛을 발하는 하루입니다. ✨", text: "{name}님, 지금까지 묵묵히 노력해온 것들이 서서히 결실을 맺을 준비를 하고 있습니다. 오늘은 스스로를 칭찬해주세요." },
    { title: "금전운과 성취운이 깃든 하루입니다! 💰", text: "{name}님, 오늘은 당신의 직감력이 유난히 뛰어난 날입니다. 결정해야 할 일이 있다면 마음이 이끄는 대로 선택해보세요." },
    { title: "조금 쉬어가도 좋은 여유로운 하루입니다. ☕", text: "{name}님, 오늘은 무리하게 진도를 빼기보다 상황을 반추하고 마음을 다독이는 시간이 필요합니다. 쉼이 곧 전진입니다." },
    { title: "귀인의 도움으로 막힌 일이 풀릴 징조입니다. 🤝", text: "{name}님, 평소 연락하지 않던 지인이나 동료의 한마디가 큰 실마리가 될 수 있습니다. 마음을 열고 다가가세요." },
    { title: "내 안의 에너지가 넘쳐흐르는 하루입니다! 🔥", text: "{name}님, 계획했던 일이 있다면 바로 오늘 시작하세요. 넘치는 열정이 주변 사람들까지 긍정적으로 물들일 것입니다." },
    { title: "지혜롭게 위기를 기회로 바꿀 수 있는 날! 🧠", text: "{name}님, 사소한 오해나 실수가 생기더라도 당황하지 마세요. 오히려 그것이 전화위복이 되어 더 좋은 결과를 낳을 운세입니다." },
    { title: "소소한 행복이 연속되는 하루입니다. 🎀", text: "{name}님, 오늘은 기대하지 않았던 작은 일들이 모여 큰 행복을 만들어내는 날입니다. 주위를 둘러보며 미소를 지어보세요." },
    { title: "창의력이 샘솟는 아이디어의 날입니다! 💡", text: "{name}님, 머릿속에 떠오른 그 생각, 가볍게 넘기지 마세요. 오늘 떠오른 직감이 당신을 아주 좋은 방향으로 이끌어 줄 것입니다." },
    { title: "고요한 호수처럼 평온한 하루입니다. 🌊", text: "{name}님, 오늘 하루는 외부의 소음에서 벗어나 내면의 소리에 집중하기 좋은 날입니다. 큰 동요 없이 잔잔한 평화가 찾아옵니다." },
    { title: "새로운 인연이 기다리는 하루! 🌟", text: "{name}님, 오늘 마주치는 낯선 사람이나 새로운 모임을 눈여겨보세요. 인생의 든든한 조력자가 될 인연을 만날 수 있습니다." },
    { title: "과거의 노력이 뜻밖의 보상으로 돌아오는 날! 🎁", text: "{name}님, 잊고 지냈던 지난날의 수고가 깜짝 선물처럼 당신에게 돌아옵니다. 기분 좋은 소식을 기대해 보셔도 좋습니다." },
    { title: "마음의 매듭이 사르르 풀리는 하루. 🧶", text: "{name}님, 오랫동안 안고 있던 고민이나 오해가 눈 녹듯 사라지는 날입니다. 한결 가벼워진 마음으로 내일을 맞이하세요." },
    { title: "작은 변화가 큰 즐거움을 주는 날! 🎨", text: "{name}님, 평소와 다른 출근길, 늘 가던 식당 대신 새로운 메뉴. 오늘은 아주 작은 변화 하나가 하루 전체의 기분을 끌어올려 줍니다." },
    { title: "마법 같은 우연이 겹치는 하루! ✨", text: "{name}님, 생각하던 사람이 먼저 연락을 해오거나, 잃어버렸던 물건을 우연히 찾는 등 신기하고 기분 좋은 우연이 가득한 날입니다." },
    { title: "진심이 통하는 맑고 투명한 하루. 💎", text: "{name}님, 오늘은 빙빙 돌려 말하기보다 솔직하게 당신의 마음을 표현해 보세요. 진정성 있는 태도가 당신의 매력을 돋보이게 합니다." },
    { title: "한 걸음 물러나면 더 넓게 보이는 날! 🔭", text: "{name}님, 눈앞의 문제에 너무 몰두해 있다면 잠시 멈춰보세요. 한발 떨어져서 보면 그토록 찾던 해답이 선명하게 보일 것입니다." },
    { title: "몸과 마음의 밸런스가 완벽한 하루! ⚖️", text: "{name}님, 컨디션이 유독 좋고 긍정적인 에너지가 가득합니다. 미뤄뒀던 운동이나 취미생활을 시작하기에 가장 완벽한 날이에요." },
    { title: "나눔과 베풂이 배가 되어 돌아오는 날! 🤲", text: "{name}님, 주변 사람에게 작은 호의를 베풀어 보세요. 커피 한 잔, 따뜻한 칭찬 한마디가 몇 배의 긍정적인 운기로 당신에게 돌아옵니다." },
    { title: "묵은 감정이 씻겨 내려가는 상쾌한 날! 🚿", text: "{name}님, 마음 한편을 짓누르던 감정의 찌꺼기들이 시원하게 씻겨 나갑니다. 깨끗해진 마음의 방에 새로운 기쁨을 채워 넣으세요." },
    { title: "결단력이 최고의 무기가 되는 하루! ⚔️", text: "{name}님, 우유부단함은 내려놓고 단호하게 결정하세요. 오늘 당신의 빠른 판단이 복잡하게 얽힌 상황을 단번에 정리해 줄 것입니다." },
    { title: "뜻밖의 장소에서 영감을 얻는 날! 📸", text: "{name}님, 무심코 걷던 길, 자주 가던 카페의 창가. 아주 평범한 일상의 장면에서 일과 삶의 중요한 영감을 번뜩이게 될 것입니다." },
    { title: "오랜 바람이 현실의 문턱에 다가선 날! 🚪", text: "{name}님, 마음속으로 수없이 바라던 일의 실마리가 드디어 눈앞에 보이기 시작합니다. 희망을 품고 한 발자국만 더 다가가 보세요." },
    { title: "사람들 사이에서 중심이 되는 하루! 👑", text: "{name}님, 오늘은 어디에 있든 당신의 의견에 힘이 실리고 사람들이 당신을 따릅니다. 리더십을 부드럽게 발휘해 보세요." },
    { title: "예상치 못한 여유가 찾아오는 날! 🛋️", text: "{name}님, 일정이 꼬이거나 갑작스럽게 취소되는 일이 생겨 오히려 꿀맛 같은 휴식 시간이 주어집니다. 온전히 나를 위해 누리세요." },
    { title: "재물운이 상승 기류를 타는 하루! 📈", text: "{name}님, 잃어버린 돈을 찾거나 소소한 부수입이 생길 수도 있습니다. 재무 계획을 세우거나 투자를 결심하기 좋은 날입니다." },
    { title: "말실수를 줄이면 완벽해지는 날! 🤐", text: "{name}님, 오늘은 생각나는 대로 바로 말하기보다 마음속으로 한 번 더 걸러서 내뱉는 지혜가 필요합니다. 침묵이 금이 됩니다." },
    { title: "잊고 지낸 재능이 다시 반짝이는 하루! 🌟", text: "{name}님, 예전에 좋아했던 취미나 잘했던 기술을 우연히 다시 꺼내보게 됩니다. 여전히 녹슬지 않은 내 안의 빛을 확인하게 될 거예요." },
    { title: "감수성이 풍부해지는 감성 충만의 날! 🎵", text: "{name}님, 오늘은 음악 한 곡, 바람 한 점에도 깊은 위로를 받습니다. 무미건조했던 마음에 촉촉한 감성의 단비가 내릴 것입니다." },
    { title: "작은 용기가 큰 성취로 이어지는 날! 🦁", text: "{name}님, 망설이던 인사를 건네거나, 주저하던 의견을 내보세요. 아주 사소한 용기가 예상 가득한 기쁨으로 돌아옵니다." },
    { title: "잃어버린 자신감을 완벽하게 회복하는 하루! 🚀", text: "{name}님, 주변의 인정이나 작은 성공 경험 덕분에 쪼그라들었던 어깨가 활짝 펴집니다. 당신은 생각보다 훨씬 대단한 사람입니다." },
    { title: "타인의 실수를 품어주는 넉넉한 하루! 🤝", text: "{name}님, 누군가의 실수를 따지기보다 부드럽게 덮어주는 관용을 베풀게 됩니다. 그 덕분에 당신의 덕망과 평판이 훌쩍 높아집니다." },
    { title: "오랫동안 막혔던 일이 시원하게 뚫리는 날! 🛣️", text: "{name}님, 지지부진하게 끌어오던 문제나 결재가 오늘은 드디어 깔끔하게 마무리됩니다. 속이 뻥 뚫리는 통쾌함을 맛보실 겁니다." },
    { title: "새로운 배움이 커다란 무기가 되는 하루! 📚", text: "{name}님, 호기심이 생기는 분야가 있다면 주저 말고 파고들어 보세요. 오늘 새롭게 익힌 지식이 훗날 결정적인 순간에 쓰일 것입니다." },
    { title: "평범함 속에 비범함이 감춰진 날! 💎", text: "{name}님, 일견 지루해 보이는 업무나 일상 속에서 남들은 보지 못하는 아주 특별한 기회와 진가를 발견해 내는 혜안이 생깁니다." },
    { title: "마음의 빗장을 풀고 다가가는 하루! 🗝️", text: "{name}님, 스스로 쳐둔 경계와 벽을 살짝 허물면, 예상외의 따뜻함과 다정함이 당신 곁으로 밀려들어 올 것입니다." },
    { title: "위기를 유머로 넘기는 센스가 빛나는 날! 🤡", text: "{name}님, 자칫 심각해질 수 있는 팽팽한 분위기를 당신의 재치와 유머 한마디가 살얼음판 녹이듯 긍정적으로 반전시켜 줄 것입니다." },
    { title: "한 우물을 판 보람을 느끼는 하루! 🚰", text: "{name}님, 포기하지 않고 끈질기게 매달려 온 일이 드디어 당신의 진가를 증명해 보입니다. 모두가 당신의 뚝심에 박수를 보냅니다." },
    { title: "가까운 사람과의 정이 더욱 돈독해지는 날! 🥂", text: "{name}님, 가족, 연인, 절친. 내 곁에 숨 쉬듯 당연하게 있던 사람들의 소중함을 새삼 깊이 깨닫고 사랑을 나누는 하루가 될 것입니다." },
    { title: "마음의 평정심이 주변까지 안정시키는 날! 🧘", text: "{name}님, 어수선한 상황 속에서도 당신 유독 중심을 잃지 않습니다. 당신의 그 차분함이 흔들리는 주변 사람들까지 편안하게 이끌어 줍니다." },
    { title: "과감한 거절이 내일을 지켜주는 하루! 🛑", text: "{name}님, 무리한 부탁이나 내키지 않는 제안 앞에서는 기분 좋고 단호하게 '아니오'라고 말하세요. 거절이 오히려 신뢰를 쌓아줍니다." },
    { title: "묵은 먼지를 털어내고 새 출발을 다짐하는 날! 🧹", text: "{name}님, 서랍 정리, 휴대폰 연락처 정리 등 주변 환경을 가볍게 정돈해 보세요. 청소가 당신의 복잡한 생각까지 명쾌하게 정리해 줍니다." },
    { title: "부드러움이 강함을 이기는 유연한 하루! 🎋", text: "{name}님, 팽팽하게 맞서기보다 한발 물러서 둥글게 대응해 보세요. 부러지지 않는 대나무 같은 유연함이 갈등을 잠재우고 승리를 가져옵니다." },
    { title: "내 직감을 100% 믿어도 좋은 날! 🎯", text: "{name}님, 논리나 타인의 조언보다 당신의 첫 느낌과 본능이 더 정확한 해답을 쥐고 있습니다. 속마음이 말하는 대로 주저 없이 직진하세요." },
    { title: "따뜻한 음식이 위로가 되는 소박한 하루! 🍲", text: "{name}님, 화려한 저녁 만찬보다 내가 좋아하는 소박한 음식 한 그릇이 몸과 마음의 피로를 사르르 녹여주는 그런 평온한 날입니다." },
    { title: "인내의 끝에 달콤한 열매가 맺히는 날! 🍎", text: "{name}님, '조금만 더, 하루만 더'를 되뇌며 버텨온 당신. 오늘은 그 견딤의 시간이 가장 달콤하고 확실한 보상으로 증명되는 최고의 날입니다." },
    { title: "세상의 박자가 나와 딱 맞아떨어지는 하루! 🎶", text: "{name}님, 타는 버스마다 바로 오고, 건널목 초록불이 내 발걸음에 맞춰 켜집니다. 사소하게 아귀가 척척 맞는 완벽한 타이밍의 날입니다." },
    { title: "스쳐 지나간 풍경에서 큰 위안을 받는 날! 🌅", text: "{name}님, 붉게 물드는 노을이나 길가에 핀 이름 모를 들꽃에 문득 마음이 울컥해집니다. 자연이 당신에게 다정하게 건네는 위로입니다." },
    { title: "자신을 향해 가장 관대해져도 좋은 날! 🛀", text: "{name}님, 유독 스스로에게 엄격한 당신. 오늘 하루만큼은 핑계를 대서라도 남보다 나 자신을 최우선으로 아끼고 돌봐주세요. 그래도 괜찮습니다." }
];

const MOVIE_QUOTES = [
    { text: "우리는 답을 찾을 것이다. 늘 그랬듯이.", movie: "인터스텔라 (2014)" },
    { text: "때론 과감한 결단이 인생을 바꾸기도 해.", movie: "인셉션 (2010)" },
    { text: "준비가 가장 완벽한 방패다.", movie: "명량 (2014)" },
    { text: "포스가 너와 함께 하기를.", movie: "스타워즈 (1977)" },
    { text: "오늘의 특별한 순간들은 내일의 기억들이야.", movie: "알라딘 (1992)" },
    { text: "최고의 순간은 아직 오지 않았어.", movie: "토이 스토리 3 (2010)" },
    { text: "어떤 새는 새장에 가둘 수 없다. 그 깃털이 너무 아름답기 때문이다.", movie: "쇼생크 탈출 (1994)" },
    { text: "당신은 나를 더 좋은 사람이 되고 싶게 만들어요.", movie: "이보다 더 좋을 순 없다 (1997)" },
    { text: "그게 바로 나야, 완벽하지 않은 나.", movie: "데드풀 (2016)" },
    { text: "인생은 초콜릿 상자와 같은 거야. 네가 무엇을 고를지 아무도 모르잖니.", movie: "포레스트 검프 (1994)" },
    { text: "눈에 보이지 않는다고 해서 없는 것은 아니야.", movie: "나니아 연대기 (2005)" },
    { text: "가끔은 마음이 가는 대로 해야 해, 결과를 생각하지 말고.", movie: "센과 치히로의 행방불명 (2001)" },
    { text: "우리가 결정해야 할 것은 오직 우리에게 주어진 시간을 어떻게 쓸 것인가 뿐이다.", movie: "반지의 제왕 (2001)" },
    { text: "마법은 항상 네 곁에 있어.", movie: "신비한 동물사전 (2016)" },
    { text: "기억해, 네가 모은 것만이 네가 가져갈 수 있는 거야.", movie: "센과 치히로의 행방불명 (2001)" },
    { text: "우리가 세상을 구하는 게 아니라, 세상이 우리를 구하는 거야.", movie: "신과함께 (2017)" },
    { text: "매너가 사람을 만든다.", movie: "킹스맨: 시크릿 에이전트 (2015)" },
    { text: "아이 윌 비 백 (I'll be back).", movie: "터미네이터 (1984)" },
    { text: "내가 누군지 알아야겠어.", movie: "본 아이덴티티 (2002)" },
    { text: "살고 싶다면 나와 함께 가자.", movie: "터미네이터 2 (1991)" },
    { text: "와칸다 포에버!", movie: "블랙 팬서 (2018)" },
    { text: "복수는 차갑게 식혀 먹어야 맛있는 음식과 같다.", movie: "킬 빌 (2003)" },
    { text: "야, 4885. 너지?", movie: "추격자 (2008)" },
    { text: "너나 잘하세요.", movie: "친절한 금자씨 (2005)" },
    { text: "세상에서 가장 큰 속임수는 악마가 자신은 존재하지 않는다고 세상을 설득한 것이다.", movie: "유주얼 서스펙트 (1995)" },
    { text: "가장 잔인한 괴물은 인간의 형태를 하고 있다.", movie: "고백 (2010)" },
    { text: "해리, 네가 누구인지 보여주는 건 너의 능력이 아니라 너의 선택이란다.", movie: "해리 포터와 비밀의 방 (2002)" },
    { text: "니가 가라 호와이.", movie: "친구 (2001)" },
    { text: "살려는 드릴게.", movie: "신세계 (2013)" },
    { text: "호의가 계속되면, 그게 권리인 줄 알아요.", movie: "부당거래 (2010)" },
    { text: "어이가 없네?", movie: "베테랑 (2015)" },
    { text: "내가 거절할 수 없는 제안을 하겠다.", movie: "대부 (1972)" },
    { text: "내가 빙다리 핫바지로 보이냐?", movie: "타짜 (2006)" },
    { text: "너의 췌장을 먹고 싶어.", movie: "너의 췌장을 먹고 싶어 (2018)" },
    { text: "과거는 아플 수 있어. 하지만 넌 거기서 도망칠 수도 있고, 배울 수도 있지.", movie: "라이온 킹 (1994)" },
    { text: "보이지 않는다고 해서 믿지 못할 이유는 없지.", movie: "엘리멘탈 (2023)" },
    { text: "사랑을 노력한다는 게 말이 돼?", movie: "8월의 크리스마스 (1998)" },
    { text: "어떻게 사랑이 변하니?", movie: "봄날은 간다 (2001)" },
    { text: "사랑은 눈으로 보는 것이 아니라, 마음으로 보는 거야.", movie: "라 라 랜드 (2016)" },
    { text: "당신을 만나기 전까지, 내 인생은 흑백이었어요.", movie: "로마의 휴일 (1953)" },
    { text: "우리 진짜 사귀는 거 맞아요?", movie: "헤어질 결심 (2022)" },
    { text: "지금까지 이런 맛은 없었다. 이것은 갈비인가 통닭인가.", movie: "극한직업 (2019)" },
    { text: "난 괜찮아, 아주 멀쩡해!", movie: "아가씨 (2016)" },
    { text: "너는 계획이 다 있구나!", movie: "기생충 (2019)" },
    { text: "오, 선장님, 나의 선장님!", movie: "죽은 시인의 사회 (1989)" },
    { text: "인생은 덧없이 스쳐 지나가. 멈춰 서서 주위를 둘러보지 않으면 놓치고 말 거야.", movie: "페리스의 해방 (1986)" },
    { text: "아무리 길고 험난한 밤이라도, 결국 해는 떠오르기 마련이지.", movie: "다크 나이트 (2008)" },
    { text: "사람들은 항상 보고 싶은 것만 보지.", movie: "나를 찾아줘 (2014)" },
    { text: "네 인생의 주인은 너 자신이야. 다른 누구도 널 대신 살아주지 않아.", movie: "위대한 쇼맨 (2017)" },
    { text: "살아남아라, 그대는 아름답다.", movie: "모노노케 히메 (1997)" },
    { text: "길이란 걷는 것이지 증명하는 것이 아니다.", movie: "달콤한 인생 (2005)" },
    { text: "중요한 건 꺾이지 않는 마음.", movie: "리그 오브 레전드 월드 챔피언십 (스페셜)" },
    { text: "웃어라, 온 세상이 너와 함께 웃을 것이다. 울어라, 너 혼자 울 것이다.", movie: "올드보이 (2003)" },
    { text: "누구에게나 계획은 있다. 쳐맞기 전까지는.", movie: "마이크 타이슨 다큐멘터리" },
    { text: "끝날 때까지 끝난 게 아니다.", movie: "야구 영화 공통" },
    { text: "나에게는 꿈이 있습니다.", movie: "킹 목사 연설문 다큐" },
    { text: "신에게는 아직 12척의 배가 남아있사옵니다.", movie: "명량 (2014)" },
    { text: "겁내지 마라. 두려움은 환상일 뿐이다.", movie: "애프터 어스 (2013)" },
    { text: "나는 세상을 구하려는 게 아니야. 그냥 내 가족을 지키고 싶을 뿐.", movie: "어벤져스: 엔드게임 (2019)" },
    { text: "이젠 내가 누구인지 기억조차 나지 않아.", movie: "메멘토 (2000)" },
    { text: "내일은 내일의 태양이 뜬다.", movie: "바람과 함께 사라지다 (1939)" },
    { text: "내가 왕이 될 상인가?", movie: "관상 (2013)" },
    { text: "두려움은 마음을 죽이는 살인자다.", movie: "듄 (2021)" },
    { text: "가장 어두운 시간이 바로 해가 뜨기 직전이다.", movie: "배트맨 비긴즈 (2005)" },
    { text: "왜 넘어지는 줄 알아? 다시 일어나는 법을 배우기 위해서야.", movie: "배트맨 비긴즈 (2005)" },
    { text: "위대한 힘에는 큰 책임이 따른다.", movie: "스파이더맨 (2002)" },
    { text: "계속 헤엄쳐라, 계속 헤엄쳐라.", movie: "니모를 찾아서 (2003)" },
    { text: "내가 너의 방패가 되어 줄게.", movie: "캡틴 아메리카" },
    { text: "고통은 필연이지만, 괴로움은 선택이다.", movie: "무라카미 하루키 소설 원작" },
    { text: "이 또한 지나가리라.", movie: "많은 고전 영화" },
    { text: "누군가를 진심으로 사랑한다면 그를 놓아줘야 해.", movie: "다수의 로맨스 영화" },
    { text: "미친 짓이란 매번 똑같은 일을 하면서 다른 결과를 바라는 것이다.", movie: "아인슈타인 명언 인용" },
    { text: "도전하지 않으면 실패조차 할 수 없다.", movie: "스포츠 영화 공통" },
    { text: "결과는 노력에 배신하지 않는다.", movie: "드라마틱한 성공담" },
    { text: "나를 죽이지 못하는 고통은 나를 더 강하게 만든다.", movie: "니체 명언 기반 영화" },
    { text: "진실은 항상 차갑고 잔인하다.", movie: "스릴러 장르 공통" },
    { text: "행복은 목적지가 아니라 여정 그 자체다.", movie: "잔잔한 힐링 무비" },
    { text: "오늘 하루에 최선을 다하라. 내일은 아무도 모른다.", movie: "생존 서바이벌 장르" },
    { text: "너 자신을 믿는 곳에서 기적은 시작된다.", movie: "디즈니 애니메이션 공통" },
    { text: "한 사람의 결단이 모두의 운명을 바꿀 수 있다.", movie: "재난 블록버스터" },
    { text: "끝이 없는 길은 없어. 언젠가는 도착점이 있지.", movie: "로드 무비" },
    { text: "우리가 잃어버린 것은 과거가 아니라 미래다.", movie: "포스트 아포칼립스 장르" },
    { text: "상처받은 영혼만이 서로를 치유할 수 있다.", movie: "휴먼 드라마" },
    { text: "거짓말은 언젠가 드러나게 되어 있어.", movie: "범죄 스릴러" },
    { text: "모든 만남에는 다 이유가 있는 법이야.", movie: "인연을 다룬 멜로" },
    { text: "너의 가능성은 끝이 없어. 한계를 두지 마.", movie: "SF 우주 공상" },
    { text: "아무것도 하지 않으면 아무 일도 일어나지 않아.", movie: "열정 자극 영화" },
    { text: "때로는 침묵이 백 마디 말보다 낫다.", movie: "누아르 장르" },
    { text: "정의는 반드시 승리한다. 언젠가는.", movie: "히어로 무비" },
    { text: "마지막 거북이는 가장 천천히, 하지만 가장 확실하게 간다.", movie: "우화 기반 영화" },
    { text: "단 하나의 불꽃이 어둠을 사를 수 있다.", movie: "혁명기반 영화" },
    { text: "지금 네 옆에 있는 사람을 소중히 여겨라.", movie: "가족 드라마" },
    { text: "모험을 두려워하는 자는 아무것도 얻지 못한다.", movie: "판타지 모험물" },
    { text: "내 인생의 주인공은 바로 나다.", movie: "성장 스토리 무비" },
    { text: "눈물이 마를 때 진짜 강해지는 거야.", movie: "권투/격투 영화" },
    { text: "진실과 직면하는 것이 가장 아픈 법이다.", movie: "법정 드라마" },
    { text: "가장 아름다운 꽃은 벼랑 끝에서 피어난다.", movie: "고난 극복물" },
    { text: "오늘이 내 생애 가장 젊은 날이다.", movie: "시간여행 또는 노년의 이야기" },
    { text: "아무도 모르는 비밀은 때론 가장 무거운 짐이 돼.", movie: "미스터리 스릴러" },
    { text: "잊지 마, 네 곁에는 늘 응원하는 내가 있다는 걸.", movie: "잔잔한 우정 영화" }
];

export async function POST(req: Request) {
    try {
        const { name, gender, calendarType, birthYear, birthMonth, birthDay, birthTime } = await req.json();

        if (!birthYear || !birthMonth || !birthDay) {
            return NextResponse.json({ error: 'Missing required fields' }, { status: 400 });
        }

        // 1. 한국 시간(KST) 기준 오늘의 날짜 문자열 만들기 (예: 20241027)
        const now = new Date();
        const kstOffset = 9 * 60 * 60 * 1000;
        const kstDate = new Date(now.getTime() + kstOffset);
        const todayStr = `${kstDate.getUTCFullYear()}${kstDate.getUTCMonth() + 1}${kstDate.getUTCDate()}`;

        // 2. 사주 입력 정보 + 오늘 날짜를 조합하여 고유한 "시드(Seed)" 텍스트 생성
        // 이렇게 하면 하루 동안은 같은 사람이 계속 돌려도 동일한 결과가 나오고, 다음 날 자정이 지나면 바뀜!
        const seedString = `${name}-${birthYear}-${birthMonth}-${birthDay}-${gender}-${calendarType}-${birthTime}-${todayStr}`;

        // 3. 생성된 텍스트를 숫자로 변환하는 해시(Hash) 함수
        let hash = 0;
        for (let i = 0; i < seedString.length; i++) {
            hash = ((hash << 5) - hash) + seedString.charCodeAt(i);
            hash |= 0; // 32bit 정수화
        }

        // 무조건 양수가 되도록 처리
        const positiveHash = Math.abs(hash);

        // 4. 해시값을 길이로 나눈 나머지를 인덱스로 사용하여 랜덤 선택 효과 부여
        const fortuneIndex = positiveHash % FORTUNE_TEMPLATES.length;
        // 명대사는 해시값을 조금 변형하여 (비트 이동) 서로 독립적인 인덱스를 뽑도록 처리
        const quoteIndex = (positiveHash >> 2) % MOVIE_QUOTES.length;

        const selectedFortune = FORTUNE_TEMPLATES[fortuneIndex];
        const selectedQuote = MOVIE_QUOTES[quoteIndex];

        const result = {
            title: selectedFortune.title,
            fortune: selectedFortune.text.replace(/{name}/g, name || '익명'),
            quoteText: selectedQuote.text,
            quoteMovie: selectedQuote.movie
        };

        // 프리미엄 AI 감성을 유지하기 위해 실제 AI가 생각하는 것처럼 약 1.5초 지연 대기
        await new Promise(resolve => setTimeout(resolve, 1500));

        return NextResponse.json(result);

    } catch (error) {
        console.error('Error generating fortune:', error);
        return NextResponse.json(
            {
                title: "오류가 발생했습니다 ㅠㅠ",
                fortune: "운세를 불러오는 과정에서 오류가 발생했습니다. 잠시 후 다시 시도해주세요.",
                quoteText: "실패란 넘어지는 것이 아니라 넘어진 자리에 머무는 것이다.",
                quoteMovie: "오류 메시지"
            },
            { status: 500 }
        );
    }
}
